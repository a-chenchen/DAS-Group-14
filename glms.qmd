---
title: ""
number-sections: true
format: 
  html:
    embed-resources: true
    code-tools: true
  pdf: default
editor_options: 
  chunk_output_type: console
execute:
  echo: true
  eval: true
  warning: false
  message: false
---

```{r}
library(tidyverse)
library(moderndive)
library(gapminder)
library(sjPlot)
library(stats)
library(jtools)
library(dplyr)
library(knitr)
library(janitor)
library(MASS)
library(sjPlot)
```

Data wrangling and subseting

```{r}
#data wrangling and subseting
data = read.csv('dataset14.csv')
mapping = c('Poor' = 0, 'Good' = 1)
data$Qualityclass = mapping[data$Qualityclass]
data$country_of_origin = as.factor(data$country_of_origin)
data$harvested = as.factor(data$harvested)
data = data %>%
  filter(country_of_origin == 'Brazil' | country_of_origin == 'Colombia')
data <- na.omit(data)
```

```{r}
table(data$country_of_origin)
```

## Not removing variables

Here we use all variables to fit a full logistic regression model:

```{r}
full_model = glm(formula = data$Qualityclass ~ ., family = binomial(link = 'logit'),data = data)
```

```{r}
full_model %>%
  summary()
```

AIC=164.97

```{r}
table(data$harvested)
```

It is shown that the 'category_two_defects' variable and 'altitude_mean_meters' variable are insignificant, thus

## Using stepAIC() to obtain a general comprehension
```{r}
stepAIC(full_model)
```
stepAIC() shows the final model is without 'harvested' and 'altitude_mean_meters': 
Step:  AIC=157.45
data$Qualityclass ~ country_of_origin + aroma + flavor + acidity + 
    category_two_defects
    
stepAIC() shows the second final model is without 'harvested': 
Step:  AIC=159.02
data$Qualityclass ~ country_of_origin + aroma + flavor + acidity + 
    category_two_defects + altitude_mean_meters
    
which indicates that to obtain a better glm model, 'harvested' variable should be removed. 
Following are discussions on the 'category_two_defects' variable and 'altitude_mean_meters' variable
## Removing the 'harvested' and 'category_two_defects' variable

```{r}
data1 <- data %>%
  filter(country_of_origin == 'Brazil' | country_of_origin == 'Colombia') %>%
  dplyr::select(-c(category_two_defects, harvested))

```

Here we use subseted variables to fit a new logistic regression model:

```{r}
model1 = glm(formula = data1$Qualityclass ~ ., family = binomial(link = 'logit'),data = data1)
```

```{r}
model1 %>%
  summary()
```

AIC=158.53

## Removing the 'harvested' and 'altitude_mean_meters' variable
```{r}
data2 <- data %>%
  filter(country_of_origin == 'Brazil' | country_of_origin == 'Colombia') %>%
  dplyr::select(-c(altitude_mean_meters, harvested))

```

Here we use subsetted variables to fit a new logistic regression model:

```{r}
model2 = glm(formula = data1$Qualityclass ~ ., family = binomial(link = 'logit'),data = data2)
```

```{r}
model2 %>%
  summary()
```
AIC=157.45
## Removing the 'harvested', 'category_two_defects' variable and the 'altitude_mean_meters' variable

```{r}
data3 <- data %>%
  filter(country_of_origin == 'Brazil' | country_of_origin == 'Colombia') %>%
  dplyr::select(-c(category_two_defects, altitude_mean_meters, harvested))
```

Here we use subsetted variables to fit a new logistic regression model:

```{r}
model3 = glm(formula = data2$Qualityclass ~ ., family = binomial(link = 'logit'),data = data3)
```

```{r}
model3 %>%
  summary()
```

AIC=158.29

## Conclusion
full_model: AIC=164.97
By removing 'harvested' only: AIC=159.02
By removing 'harvested' and 'category_two_defects' variable: AIC=158.53
By removing 'harvested' and 'altitude_mean_meters' variable: AIC=157.45
By removing 'harvested', 'category_two_defects' variable and the 'altitude_mean_meters' variable: AIC=158.29

Thus, we can remove 'harvested' and 'altitude_mean_meters'. Other combinations listed are also suitable as they have similar AICs. 
